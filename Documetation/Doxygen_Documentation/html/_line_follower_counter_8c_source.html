<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Scout_Robot/LineFollowerCounter.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>Scout_Robot/LineFollowerCounter.c</h1><a href="_line_follower_counter_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/********************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> Written by: Mehadi Seid, Swanand Kulkarni, Rajesh Kaushik</span>
<a name="l00003"></a>00003 <span class="comment"> AVR Studio Version 4.17, Build 666</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment"> Starting Date: 20 September 2010</span>
<a name="l00006"></a>00006 <span class="comment"> End Date: 8 November 2010</span>
<a name="l00007"></a>00007 <span class="comment">*********************************************************************************/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/********************************************************************************</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">   Copyright (c) 2010, ERTS Lab.                       -*- c -*-</span>
<a name="l00012"></a>00012 <span class="comment">   All rights reserved.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">   Redistribution and use in source and binary forms, with or without</span>
<a name="l00015"></a>00015 <span class="comment">   modification, are permitted provided that the following conditions are met:</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   * Redistributions of source code must retain the above copyright</span>
<a name="l00018"></a>00018 <span class="comment">     notice, this list of conditions and the following disclaimer.</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">   * Redistributions in binary form must reproduce the above copyright</span>
<a name="l00021"></a>00021 <span class="comment">     notice, this list of conditions and the following disclaimer in</span>
<a name="l00022"></a>00022 <span class="comment">     the documentation and/or other materials provided with the</span>
<a name="l00023"></a>00023 <span class="comment">     distribution.</span>
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">   * Neither the name of the copyright holders nor the names of</span>
<a name="l00026"></a>00026 <span class="comment">     contributors may be used to endorse or promote products derived</span>
<a name="l00027"></a>00027 <span class="comment">     from this software without specific prior written permission.</span>
<a name="l00028"></a>00028 <span class="comment"></span>
<a name="l00029"></a>00029 <span class="comment">   * Source code can be used for academic purpose. </span>
<a name="l00030"></a>00030 <span class="comment">  For commercial use permission form the author needs to be taken.</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<a name="l00033"></a>00033 <span class="comment">  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<a name="l00034"></a>00034 <span class="comment">  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<a name="l00035"></a>00035 <span class="comment">  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<a name="l00036"></a>00036 <span class="comment">  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<a name="l00037"></a>00037 <span class="comment">  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<a name="l00038"></a>00038 <span class="comment">  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<a name="l00039"></a>00039 <span class="comment">  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<a name="l00040"></a>00040 <span class="comment">  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<a name="l00041"></a>00041 <span class="comment">  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<a name="l00042"></a>00042 <span class="comment">  POSSIBILITY OF SUCH DAMAGE. </span>
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">  Software released under Creative Commence cc by-nc-sa licence.</span>
<a name="l00045"></a>00045 <span class="comment">  For legal information refer to: </span>
<a name="l00046"></a>00046 <span class="comment">  http://creativecommons.org/licenses/by-nc-sa/3.0/legalcode</span>
<a name="l00047"></a>00047 <span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">********************************************************************************/</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="comment">/*</span>
<a name="l00052"></a>00052 <span class="comment">* Code For Scout Robot</span>
<a name="l00053"></a>00053 <span class="comment">*</span>
<a name="l00054"></a>00054 <span class="comment">*/</span>
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;firebird_winavr.h&quot;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="_line_follower_counter_8c.html#a1d7b72031fa39d396d531503904f337b">00058</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a1d7b72031fa39d396d531503904f337b">position</a> = 0; <span class="comment">// Record the current postion of Robot using block count.</span>
<a name="l00059"></a><a class="code" href="_line_follower_counter_8c.html#af48e0311746bc01574a90f142220e748">00059</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="_line_follower_counter_8c.html#af48e0311746bc01574a90f142220e748">command</a> = 0;
<a name="l00060"></a><a class="code" href="_line_follower_counter_8c.html#a37d145f01d952970d059941663ccfff0">00060</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a37d145f01d952970d059941663ccfff0">stopDistance</a> = 200;
<a name="l00061"></a><a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">00061</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> = 40;
<a name="l00062"></a><a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">00062</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a> = 120;
<a name="l00063"></a><a class="code" href="_line_follower_counter_8c.html#a496e53769bd08930fd22618690e20621">00063</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a496e53769bd08930fd22618690e20621">mediumSpeed</a> = 100;
<a name="l00064"></a><a class="code" href="_line_follower_counter_8c.html#a902c10aeadbed6441e1361ea8949cb7f">00064</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a902c10aeadbed6441e1361ea8949cb7f">slowSpeed</a> = 80;
<a name="l00065"></a><a class="code" href="_line_follower_counter_8c.html#a6a88a42d06770ea17c78a8368b29e4ce">00065</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a6a88a42d06770ea17c78a8368b29e4ce">RIGHT_WHITELINE_VALUE</a>;
<a name="l00066"></a><a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">00066</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">MIDDLE_WHITELINE_VALUE</a>;
<a name="l00067"></a><a class="code" href="_line_follower_counter_8c.html#a6c90d82e3056adb1bbd594030944d3d5">00067</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a6c90d82e3056adb1bbd594030944d3d5">LEFT_WHITELINE_VALUE</a>;
<a name="l00068"></a><a class="code" href="_line_follower_counter_8c.html#afa5f52316976b037653d0964815ca85f">00068</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#afa5f52316976b037653d0964815ca85f">FRONT_IR_VALUE</a>;
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">00070</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 0;
<a name="l00071"></a><a class="code" href="_line_follower_counter_8c.html#a5004342352f04d68ff8f12c17ec2cf6f">00071</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a5004342352f04d68ff8f12c17ec2cf6f">completeBlack</a> = 0;
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="_line_follower_counter_8c.html#ae515db750874720ff18664c8252ae6d8">00073</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#ae515db750874720ff18664c8252ae6d8">ShaftCountLeft</a> = 0;
<a name="l00074"></a><a class="code" href="_line_follower_counter_8c.html#a871859f12e0b2563b435d6c3c6b2759e">00074</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a871859f12e0b2563b435d6c3c6b2759e">ShaftCountRight</a> = 0;
<a name="l00075"></a><a class="code" href="_line_follower_counter_8c.html#a13b7401bc88be06cfce141b3aacd5256">00075</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a13b7401bc88be06cfce141b3aacd5256">ShaftCountMax</a> = 10;
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="_line_follower_counter_8c.html#a34c0c3ce843ecb8ee20be9eee84cac2d">00077</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a34c0c3ce843ecb8ee20be9eee84cac2d">prevLeftSpeed</a> = 0;
<a name="l00078"></a><a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">00078</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">prevRightSpeed</a> = 0;
<a name="l00079"></a><a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">00079</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 0;  <span class="comment">//1 - white, 0 - black</span>
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="_line_follower_counter_8c.html#a0971b43360abc733cbc1b30a1282c663">00081</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="_line_follower_counter_8c.html#a0971b43360abc733cbc1b30a1282c663">sendOnce</a> = 0;  <span class="comment">//1 - send when stoping, 0 - already sent</span>
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="_line_follower_counter_8c.html#a98a290ada01eb27fd2ff4564371566e5">00083</a> <a class="code" href="_line_follower_counter_8c.html#a98a290ada01eb27fd2ff4564371566e5">ISR</a>(INT4_vect)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085  <a class="code" href="_line_follower_counter_8c.html#ae515db750874720ff18664c8252ae6d8">ShaftCountLeft</a>++; <span class="comment">//increment left shaft position count</span>
<a name="l00086"></a>00086  <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#ae515db750874720ff18664c8252ae6d8">ShaftCountLeft</a> &gt; <a class="code" href="_line_follower_counter_8c.html#a13b7401bc88be06cfce141b3aacd5256">ShaftCountMax</a>)
<a name="l00087"></a>00087  {
<a name="l00088"></a>00088   <a class="code" href="_line_follower_counter_8c.html#a5004342352f04d68ff8f12c17ec2cf6f">completeBlack</a> = 1;
<a name="l00089"></a>00089  }
<a name="l00090"></a>00090 }
<a name="l00091"></a><a class="code" href="_line_follower_counter_8c.html#a6225c50fbafa01589351ed487223aacb">00091</a> <a class="code" href="_line_follower_counter_8c.html#a98a290ada01eb27fd2ff4564371566e5">ISR</a>(INT5_vect)
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093  <a class="code" href="_line_follower_counter_8c.html#a871859f12e0b2563b435d6c3c6b2759e">ShaftCountRight</a>++; <span class="comment">//increment right shaft position count</span>
<a name="l00094"></a>00094  <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a871859f12e0b2563b435d6c3c6b2759e">ShaftCountRight</a> &gt; <a class="code" href="_line_follower_counter_8c.html#a13b7401bc88be06cfce141b3aacd5256">ShaftCountMax</a>)
<a name="l00095"></a>00095  {
<a name="l00096"></a>00096   <a class="code" href="_line_follower_counter_8c.html#a5004342352f04d68ff8f12c17ec2cf6f">completeBlack</a> = 1;
<a name="l00097"></a>00097  }
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00101"></a><a class="code" href="_line_follower_counter_8c.html#ab5f8e79f6ffa3be348924e573e8dcfd1">00101</a> <a class="code" href="_line_follower_counter_8c.html#ab5f8e79f6ffa3be348924e573e8dcfd1" title="ISR for receive complete interrupt.">SIGNAL</a>(SIG_USART0_RECV)
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103  <a class="code" href="_line_follower_counter_8c.html#af48e0311746bc01574a90f142220e748">command</a> = UDR0; <span class="comment">//making copy of data from UDR0 in &#39;data&#39; variable</span>
<a name="l00104"></a>00104  <span class="comment">//LCD_DISPLAY_INT_1(4);</span>
<a name="l00105"></a>00105  <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#af48e0311746bc01574a90f142220e748">command</a> == 0x38) <span class="comment">//ASCII value of 8</span>
<a name="l00106"></a>00106   {
<a name="l00107"></a>00107    <a class="code" href="_scout___robot_2buzzer_8h.html#a7822c093795c72a5eaf02b9efa914915">BUZZER_ON</a>();
<a name="l00108"></a>00108    <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 1;
<a name="l00109"></a>00109    <a class="code" href="_line_follower_counter_8c.html#a0971b43360abc733cbc1b30a1282c663">sendOnce</a> = 1;
<a name="l00110"></a>00110    <span class="comment">//UCSR0B = UCSR0B | 0xbf;</span>
<a name="l00111"></a>00111   } 
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115  
<a name="l00117"></a><a class="code" href="_line_follower_counter_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667">00117</a> <span class="keywordtype">void</span> <a class="code" href="_line_follower_counter_8c.html#a6288eba0f8e8ad3ab1544ad731eb7667" title="Moves the scout robot to scan the field.">main</a>(<span class="keywordtype">void</span>)
<a name="l00118"></a>00118 {
<a name="l00119"></a>00119  <a class="code" href="_scout___robot_2firebird__winavr_8h.html#ab01199c927ceda6f9520c7afb0f1b099">init_devices</a>(); <span class="comment">//defined in firebird_winavr.h.  It initialize all necessary ports for LCD, Buzzer, Motion control and IR sensor.</span>
<a name="l00120"></a>00120  <a class="code" href="_line_follower_counter_8c.html#a1d7b72031fa39d396d531503904f337b">position</a> = 0;
<a name="l00121"></a>00121  <a class="code" href="_scout___robot_2firebird__winavr_8h.html#a0488fb29bb9c094d6b89d273d6ae3f1d">init_dist_measure</a>();
<a name="l00122"></a>00122 
<a name="l00123"></a>00123  UCSR0B = UCSR0B | 0x10; <span class="comment">//set bit4 = rx enables</span>
<a name="l00124"></a>00124  UCSR0B = UCSR0B | 0x08; <span class="comment">//set bit3 = tx enable</span>
<a name="l00125"></a>00125  UCSR0B = UCSR0B | 0x80;  <span class="comment">//bit-7 enable rx-complet interrupt</span>
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128  <span class="keywordflow">while</span>(1)
<a name="l00129"></a>00129  {
<a name="l00130"></a>00130   <a class="code" href="_line_follower_counter_8c.html#a6a88a42d06770ea17c78a8368b29e4ce">RIGHT_WHITELINE_VALUE</a> = <a class="code" href="_scout___robot_2whiteline_8h.html#a27221abefd1283fe0f4eaad78abbf59f">LIGHT_RIGHT</a>; <span class="comment">//LIGHT_RIGHT is a macro defines in firebird_winavr.h which returns the right whiteline sensor value.</span>
<a name="l00131"></a>00131   <a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">MIDDLE_WHITELINE_VALUE</a> = <a class="code" href="_scout___robot_2whiteline_8h.html#ad5cfd63ed1c0efa91baa26719447338c">LIGHT_MIDDLE</a>; <span class="comment">// Similar</span>
<a name="l00132"></a>00132   <a class="code" href="_line_follower_counter_8c.html#a6c90d82e3056adb1bbd594030944d3d5">LEFT_WHITELINE_VALUE</a> = <a class="code" href="_scout___robot_2whiteline_8h.html#a7ca35d36f72e4e158285f753176c4275">LIGHT_LEFT</a>; <span class="comment">// Similar</span>
<a name="l00133"></a>00133   <a class="code" href="_line_follower_counter_8c.html#afa5f52316976b037653d0964815ca85f">FRONT_IR_VALUE</a> = <a class="code" href="_scout___robot_2whiteline_8h.html#a70ad289fa09ff054116ac6df7c79b84a">FRONT_IR</a>;  <span class="comment">// Similar</span>
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 
<a name="l00136"></a>00136  <span class="comment">// LCD_DISPLAY_INT_1(FRONT_IR_VALUE); // Displays IR sensor value on first line of LCD</span>
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   <a class="code" href="_scout___robot_2lcd_8h.html#ad338066e1bb54461c273b872652bd5b9">LCD_DISPLAY_INT_1</a>(<a class="code" href="_line_follower_counter_8c.html#a1d7b72031fa39d396d531503904f337b">position</a>);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">/*  if(FRONT_IR_VALUE &lt; stopDistance)</span>
<a name="l00141"></a>00141 <span class="comment">  {</span>
<a name="l00142"></a>00142 <span class="comment">   MOTOR_LEFT_SPEED(0);</span>
<a name="l00143"></a>00143 <span class="comment">   MOTOR_RIGHT_SPEED(0);</span>
<a name="l00144"></a>00144 <span class="comment">   LCD_DISPLAY_INT_2(8);</span>
<a name="l00145"></a>00145 <span class="comment">   BUZZER_ON();</span>
<a name="l00146"></a>00146 <span class="comment">  }</span>
<a name="l00147"></a>00147 <span class="comment">  else</span>
<a name="l00148"></a>00148 <span class="comment">  {</span>
<a name="l00149"></a>00149 <span class="comment">   BUZZER_OFF();*/</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151    <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a6a88a42d06770ea17c78a8368b29e4ce">RIGHT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">MIDDLE_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a6c90d82e3056adb1bbd594030944d3d5">LEFT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> == 1)
<a name="l00152"></a>00152    {
<a name="l00153"></a>00153     <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00154"></a>00154     <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00155"></a>00155     <a class="code" href="_scout___robot_2motion_8h.html#a2590e4ebe90aee4206d58ff6c1a64ef5">MOVE_FWD</a>();
<a name="l00156"></a>00156     <a class="code" href="_scout___robot_2lcd_8h.html#a71edb5dcd2805c0f4fc1526910d44136">LCD_DISPLAY_INT_2</a>(1);
<a name="l00157"></a>00157     
<a name="l00158"></a>00158     <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 1;
<a name="l00159"></a>00159     <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 1;
<a name="l00160"></a>00160     <a class="code" href="_line_follower_counter_8c.html#a34c0c3ce843ecb8ee20be9eee84cac2d">prevLeftSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>;
<a name="l00161"></a>00161     <a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">prevRightSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>;
<a name="l00162"></a>00162    }
<a name="l00163"></a>00163    <span class="keywordflow">else</span>
<a name="l00164"></a>00164    {
<a name="l00165"></a>00165     <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a6a88a42d06770ea17c78a8368b29e4ce">RIGHT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">MIDDLE_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a>  &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> == 1)
<a name="l00166"></a>00166     {
<a name="l00167"></a>00167      <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00168"></a>00168      <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#a496e53769bd08930fd22618690e20621">mediumSpeed</a>);
<a name="l00169"></a>00169      <a class="code" href="_scout___robot_2motion_8h.html#a2590e4ebe90aee4206d58ff6c1a64ef5">MOVE_FWD</a>();
<a name="l00170"></a>00170      <a class="code" href="_scout___robot_2lcd_8h.html#a71edb5dcd2805c0f4fc1526910d44136">LCD_DISPLAY_INT_2</a>(2);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172      <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 1;
<a name="l00173"></a>00173      <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 1;
<a name="l00174"></a>00174      <a class="code" href="_line_follower_counter_8c.html#a34c0c3ce843ecb8ee20be9eee84cac2d">prevLeftSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>;
<a name="l00175"></a>00175      <a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">prevRightSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#a496e53769bd08930fd22618690e20621">mediumSpeed</a>;
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177     <span class="keywordflow">else</span>
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179      <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">MIDDLE_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a6c90d82e3056adb1bbd594030944d3d5">LEFT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a>  &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> == 1)
<a name="l00180"></a>00180      {
<a name="l00181"></a>00181       <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#a496e53769bd08930fd22618690e20621">mediumSpeed</a>);
<a name="l00182"></a>00182       <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00183"></a>00183       <a class="code" href="_scout___robot_2motion_8h.html#a2590e4ebe90aee4206d58ff6c1a64ef5">MOVE_FWD</a>();
<a name="l00184"></a>00184       <a class="code" href="_scout___robot_2lcd_8h.html#a71edb5dcd2805c0f4fc1526910d44136">LCD_DISPLAY_INT_2</a>(3);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186       <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 1;
<a name="l00187"></a>00187       <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 1;
<a name="l00188"></a>00188       <a class="code" href="_line_follower_counter_8c.html#a34c0c3ce843ecb8ee20be9eee84cac2d">prevLeftSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#a496e53769bd08930fd22618690e20621">mediumSpeed</a>;
<a name="l00189"></a>00189       <a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">prevRightSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>;
<a name="l00190"></a>00190      }
<a name="l00191"></a>00191      <span class="keywordflow">else</span>
<a name="l00192"></a>00192      {
<a name="l00193"></a>00193       <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a6a88a42d06770ea17c78a8368b29e4ce">RIGHT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a>  &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> == 1)
<a name="l00194"></a>00194       {
<a name="l00195"></a>00195        <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00196"></a>00196        <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#a902c10aeadbed6441e1361ea8949cb7f">slowSpeed</a>);
<a name="l00197"></a>00197        <a class="code" href="_scout___robot_2motion_8h.html#a2590e4ebe90aee4206d58ff6c1a64ef5">MOVE_FWD</a>();
<a name="l00198"></a>00198        <a class="code" href="_scout___robot_2lcd_8h.html#a71edb5dcd2805c0f4fc1526910d44136">LCD_DISPLAY_INT_2</a>(4);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200        <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 1;
<a name="l00201"></a>00201        <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 1;
<a name="l00202"></a>00202        prevL
<a name="l00203"></a>00203        <a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">prevRightSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#a902c10aeadbed6441e1361ea8949cb7f">slowSpeed</a>;
<a name="l00204"></a>00204       }
<a name="l00205"></a>00205       <span class="keywordflow">else</span>
<a name="l00206"></a>00206       {
<a name="l00207"></a>00207        <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a6c90d82e3056adb1bbd594030944d3d5">LEFT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a>  &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> == 1)
<a name="l00208"></a>00208        {
<a name="l00209"></a>00209         <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#a902c10aeadbed6441e1361ea8949cb7f">slowSpeed</a>);
<a name="l00210"></a>00210         <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00211"></a>00211         <a class="code" href="_scout___robot_2motion_8h.html#a2590e4ebe90aee4206d58ff6c1a64ef5">MOVE_FWD</a>();
<a name="l00212"></a>00212         <a class="code" href="_scout___robot_2lcd_8h.html#a71edb5dcd2805c0f4fc1526910d44136">LCD_DISPLAY_INT_2</a>(5);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 1;
<a name="l00215"></a>00215         <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 1;
<a name="l00216"></a>00216         <a class="code" href="_line_follower_counter_8c.html#a34c0c3ce843ecb8ee20be9eee84cac2d">prevLeftSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#a902c10aeadbed6441e1361ea8949cb7f">slowSpeed</a>;
<a name="l00217"></a>00217         <a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">prevRightSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>;
<a name="l00218"></a>00218        }
<a name="l00219"></a>00219        <span class="keywordflow">else</span>
<a name="l00220"></a>00220        {
<a name="l00221"></a>00221         <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">MIDDLE_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a>  &amp;&amp; <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> == 1)
<a name="l00222"></a>00222         {
<a name="l00223"></a>00223          
<a name="l00224"></a>00224          <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00225"></a>00225          <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(<a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>);
<a name="l00227"></a>00227          <a class="code" href="_scout___robot_2lcd_8h.html#a71edb5dcd2805c0f4fc1526910d44136">LCD_DISPLAY_INT_2</a>(6);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229          <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 1;
<a name="l00230"></a>00230          <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 1;
<a name="l00231"></a>00231          <a class="code" href="_line_follower_counter_8c.html#a34c0c3ce843ecb8ee20be9eee84cac2d">prevLeftSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>;
<a name="l00232"></a>00232          <a class="code" href="_line_follower_counter_8c.html#ab85651c35258527ad41ce8f20ea34135">prevRightSpeed</a> = <a class="code" href="_line_follower_counter_8c.html#ad9aab8b396b3cc6d5ec886ed89c08848">fastSpeed</a>;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234         <span class="keywordflow">else</span>  <span class="comment">// Here we need to increment the position counter, capture an image, transmit the image to centralized server along with position counter and move the robot to some precise distance so that it will cross the Black mark and proceed further.</span>
<a name="l00235"></a>00235         {
<a name="l00236"></a>00236          
<a name="l00237"></a>00237          <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> ==1)
<a name="l00238"></a>00238          {
<a name="l00239"></a>00239           <a class="code" href="_line_follower_counter_8c.html#a1d7b72031fa39d396d531503904f337b">position</a>++;
<a name="l00240"></a>00240           <a class="code" href="_line_follower_counter_8c.html#a227e31138c9cd9e9c85f9f3353cb503d">startBlack</a> = 0;
<a name="l00241"></a>00241           <a class="code" href="_line_follower_counter_8c.html#a5004342352f04d68ff8f12c17ec2cf6f">completeBlack</a> = 0;
<a name="l00242"></a>00242           
<a name="l00243"></a>00243           <span class="comment">//start shaft counter by enabling inturupt 4 and 5</span>
<a name="l00244"></a>00244           <a class="code" href="_line_follower_counter_8c.html#ae515db750874720ff18664c8252ae6d8">ShaftCountLeft</a> = 0;
<a name="l00245"></a>00245           <a class="code" href="_line_follower_counter_8c.html#a871859f12e0b2563b435d6c3c6b2759e">ShaftCountRight</a> = 0;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247           <a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> = 0; <span class="comment">//set prev state to black</span>
<a name="l00248"></a>00248          }
<a name="l00249"></a>00249          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a5004342352f04d68ff8f12c17ec2cf6f">completeBlack</a> == 1)  <span class="comment">//last stop</span>
<a name="l00250"></a>00250          {
<a name="l00251"></a>00251           <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(0);
<a name="l00252"></a>00252           <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(0);
<a name="l00253"></a>00253            
<a name="l00254"></a>00254           <a class="code" href="_line_follower_counter_8c.html#a1d7b72031fa39d396d531503904f337b">position</a> = 99;<span class="comment">//only for test</span>
<a name="l00255"></a>00255          }
<a name="l00256"></a>00256          <span class="comment">//if prevstate is black and u detect white line stop</span>
<a name="l00257"></a>00257          <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a2214cded400f5f10aff4dced11b10b78">prevState</a> == 0 &amp;&amp; (<a class="code" href="_line_follower_counter_8c.html#a6a88a42d06770ea17c78a8368b29e4ce">RIGHT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> || <a class="code" href="_line_follower_counter_8c.html#a0ae7d1d7c31810a587fe0091c8aa12d8">MIDDLE_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a> || <a class="code" href="_line_follower_counter_8c.html#a6c90d82e3056adb1bbd594030944d3d5">LEFT_WHITELINE_VALUE</a> &lt; <a class="code" href="_line_follower_counter_8c.html#a492e7b58ed599c481757fecb578af24e">maxWhite</a>))
<a name="l00258"></a>00258          {
<a name="l00259"></a>00259           <a class="code" href="_scout___robot_2motion_8h.html#aad2b5c3032b6186491dea9117e5fa608">MOTOR_LEFT_SPEED</a>(0);
<a name="l00260"></a>00260           <a class="code" href="_scout___robot_2motion_8h.html#aa9a316d01b0ac2faac57c463de947ff8">MOTOR_RIGHT_SPEED</a>(0);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262           
<a name="l00263"></a>00263           <span class="comment">//stop and wait for &#39;continue scouting command from server (for testing use button)</span>
<a name="l00264"></a>00264           <span class="keywordflow">if</span>(<a class="code" href="_line_follower_counter_8c.html#a0971b43360abc733cbc1b30a1282c663">sendOnce</a> == 1)
<a name="l00265"></a>00265           {
<a name="l00266"></a>00266            UDR0 = (0x0f &amp; <a class="code" href="_line_follower_counter_8c.html#a1d7b72031fa39d396d531503904f337b">position</a>); <span class="comment">//sending position count</span>
<a name="l00267"></a>00267           <span class="comment">// UCSR0B = UCSR0B | 0x08; //set bit3 = tx enable</span>
<a name="l00268"></a>00268            <span class="comment">//UDR0 = 0x0D;   // &#39;CR&#39; signifies the terminator in matlab</span>
<a name="l00269"></a>00269           <span class="comment">// UCSR0B = UCSR0B | 0x08; //set bit3 = tx enable</span>
<a name="l00270"></a>00270            <a class="code" href="_line_follower_counter_8c.html#a0971b43360abc733cbc1b30a1282c663">sendOnce</a> = 0;
<a name="l00271"></a>00271           }
<a name="l00272"></a>00272           <span class="comment">/*if(command == &#39;z&#39;)// if Char c recieved</span>
<a name="l00273"></a>00273 <span class="comment">          {</span>
<a name="l00274"></a>00274 <span class="comment">           prevState = 1;</span>
<a name="l00275"></a>00275 <span class="comment">           sendOnce = 1;</span>
<a name="l00276"></a>00276 <span class="comment">           command = 0;</span>
<a name="l00277"></a>00277 <span class="comment">           LCD_DISPLAY_INT_2(72);</span>
<a name="l00278"></a>00278 <span class="comment">           </span>
<a name="l00279"></a>00279 <span class="comment">          }*/</span>
<a name="l00280"></a>00280          <span class="comment">// LCD_DISPLAY_INT_1(command);</span>
<a name="l00281"></a>00281           
<a name="l00282"></a>00282           <span class="comment">//BUZZER_ON();</span>
<a name="l00283"></a>00283           
<a name="l00284"></a>00284           <span class="comment">//disable inturupt 4  and 5</span>
<a name="l00285"></a>00285          }
<a name="l00286"></a>00286          <a class="code" href="_scout___robot_2lcd_8h.html#a71edb5dcd2805c0f4fc1526910d44136">LCD_DISPLAY_INT_2</a>(7);
<a name="l00287"></a>00287         }
<a name="l00288"></a>00288        }
<a name="l00289"></a>00289       }
<a name="l00290"></a>00290      }
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292    }
<a name="l00293"></a>00293   }
<a name="l00294"></a>00294  <span class="comment">//}</span>
<a name="l00295"></a>00295 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sat Nov 13 17:14:18 2010 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
